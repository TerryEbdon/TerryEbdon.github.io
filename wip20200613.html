<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Developer&#39;s Diary: 13-Jun-2020 Grails Secured</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="myStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="terry_avi.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Developer&#39;s Diary
   </div>
   <div id="projectbrief">Software development, with Terry Ebdon</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('wip20200613.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">13-Jun-2020 Grails Secured </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#h20200613">Spring works</a></li>
<li class="level1"><a href="#autotoc_md285">Log off</a></li>
<li class="level1"><a href="#autotoc_md286">The GSP has it</a></li>
<li class="level1"><a href="#autotoc_md287">Page protection</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="h20200613"></a>
Spring works</h1>
<p>Following on from my failed attempts with role based authorisation I spent some time studying the plugin's documentation. It's well written and I'm really starting to like what Spring Security can do. It didn't highlight anything wrong with my approach though. I then created a test app, with minimal functionality. It behaved exactly the same as my prototype, i.e. logout doesn't work and <code>BootStrap.groovy</code> can't see any assigned roles. Back to the manual.</p>
<h1><a class="anchor" id="autotoc_md285"></a>
Log off</h1>
<p>The correct way to log out is via <code>/logoff</code>. The link to a <code>logoutController</code> is a red herring.</p>
<h1><a class="anchor" id="autotoc_md286"></a>
The GSP has it</h1>
<p>I found some interesting GSP tags for getting the current user and changing behaviour based on the assigned roles. I plugged those into the <code>grails-app\views\lineUp\index.gsp</code> and gave it a bash:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">sec:ifLoggedIn</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">hr</span>/&gt;</div>
<div class="line">** <span class="keyword">Logged</span> <span class="keyword">in</span> <span class="keyword">as</span> &lt;<span class="keywordtype">sec:username</span>/&gt; **</div>
<div class="line">&lt;/<span class="keywordtype">sec:ifLoggedIn</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">hr</span>/&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">sec:access</span> <span class="keyword">expression</span>=<span class="stringliteral">&quot;hasRole(&#39;ROLE_ADMIN&#39;)&quot;</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">div</span>&gt;<span class="keyword">You</span>&amp;<span class="keyword">apos</span>;<span class="keyword">re</span> <span class="keyword">an</span> <span class="keyword">admin</span>&lt;/<span class="keywordtype">div</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">sec:access</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">sec:access</span> <span class="keyword">expression</span>=<span class="stringliteral">&quot;hasRole(&#39;ROLE_COACH&#39;)&quot;</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">div</span>&gt;<span class="keyword">You</span>&amp;<span class="keyword">apos</span>;<span class="keyword">re</span> <span class="keyword">a</span> <span class="keyword">coach</span>&lt;/<span class="keywordtype">div</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">sec:access</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">sec:access</span> <span class="keyword">expression</span>=<span class="stringliteral">&quot;hasRole(&#39;ROLE_ATHLETE&#39;)&quot;</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">div</span>&gt;<span class="keyword">You</span>&amp;<span class="keyword">apos</span>;<span class="keyword">re</span> <span class="keyword">an</span> <span class="keyword">athlete</span>&lt;/<span class="keywordtype">div</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">sec:access</span>&gt;</div>
</div><!-- fragment --><p>It works! The roles are correctly assigned and the page text changes depending on the user.</p>
<div class="image">
<img src="2020-06-13_logged_in_as_coach.jpg" alt=""/>
</div>
 <p>It looks like there are limits on the BootStrap behaviour. This doesn't seem to be documented, so may not be intentional. At this point I'm just glad to have got it working.</p>
<h1><a class="anchor" id="autotoc_md287"></a>
Page protection</h1>
<p>This was easy. I added a static rule. in <code>application.groovy</code>, allowing only users with ROLE_ADMIN or ROLE_COACH to access the list of line-ups. </p><pre class="fragment">[pattern: '/lineUp/index', access: ["hasAnyRole('ROLE_ADMIN','ROLE_COACH')"]],
[pattern: '/**',           access: ['isAuthenticated()']]
</pre><p> 
<a class='btn' href='wip20200612.html'>12-JUN-2020 ðŸ‘ˆ</a>
<a class='btn' href='#h20200613'>Top of page</a>
<a class='btn' href='wip20200615.html'>ðŸ‘‰ 15-JUN-2020</a>
</p>
<p><span class="copyright">&copy; 2020 <a href="AboutMe.html" title="Terry Ebdon">Terry Ebdon.</a></span><br  />
<p>Find me coding on <a title="terry_ebdon on BitBucket"
href="https://github.com/TerryEbdon">GitHub,</a> networking on <a
title="Terry Ebdon on LinkedIn"
href="https://www.linkedin.com/in/talent/">LinkedIn</a> and hanging out on <a
title="@terry_ebdon" href="https://twitter.com/@terry_ebdon">twitter.</a> </p>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Jul 16 2020 12:32:10 for Developer&#39;s Diary by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
