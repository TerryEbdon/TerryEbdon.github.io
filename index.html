<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-174219699-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-174219699-1');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Developer&#39;s Diary: 02-Aug-2020 awk regex groups</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="myStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="terry_avi.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Developer&#39;s Diary
   </div>
   <div id="projectbrief">Software development, with Terry Ebdon</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">02-Aug-2020 awk regex groups </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#h20200802">Retrieving regex groups in awk</a><ul><li class="level2"><a href="#autotoc_md310">Disconnect version 1</a></li>
<li class="level2"><a href="#autotoc_md311">Disconnect version 2</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="mainpage"></a></p>
<h1><a class="anchor" id="h20200802"></a>
Retrieving regex groups in awk</h1>
<p>Today I learned about gawk's enhancements to the <code>match()</code> function.</p>
<p>I wanted to report on disconnection messages in a Minecraft server's log, where the disconnect line appeared in one of two versions:</p>
<ol type="1">
<li><code>â€¦iHezi lost connection: Disconnected</code></li>
<li><code>â€¦com.mojangâ€¦authlib.GameProfile@6c2ffd3b[id=&lt;null&gt;,name=GLX27,properties=â€¦</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md310"></a>
Disconnect version 1</h2>
<p>The first version is easy:</p>
<ul>
<li>field 1 is a timestamp</li>
<li>field 4 is a number with a <code>#</code> prefix</li>
<li>field 7 is the status, e.g. "Disconnected"</li>
</ul>
<p>e.g. </p><div class="fragment"><div class="line">[16:07:29] [Server thread/INFO]: OkqySeany lost connection: Disconnected</div>
</div><!-- fragment --><p>Reporting these disconnections is trivial:</p>
<div class="fragment"><div class="line">print $1 &quot;\t&quot; $7 &quot;\t&quot; $4</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md311"></a>
Disconnect version 2</h2>
<p>The second version is more tricky. There username is now in field 4, but it's embedded in something resembling the output of a generated <code>toString()</code> method.</p>
<p>In this example of field 4 the username, GLX27, is deeply embedded, so how do I extract it?</p>
<div class="fragment"><div class="line">com.mojang.authlib.GameProfile@6c2ffd3b[<span class="keywordtype">id</span>=&lt;<span class="keyword">null</span>&gt;,name=GLX27,properties={},legacy=<span class="keyword">false</span>] (/199.26.81.77:64150) lost connection: Disconnected</div>
</div><!-- fragment --><p>Normally I'd use awk's internal <code>sub()</code> function for something like this. But <code>sub()</code> doesn't allow access to regex groups. It lets me specify the groups, but I can't see what each group matched. The gawk implementation of <code>match()</code> gives me this functionality.</p>
<p>This is the <code>match()</code> statement that extracts the username:</p>
<div class="fragment"><div class="line">match( $4, /name=\y(.+)\y,properties/, array )</div>
</div><!-- fragment --><p>Where <code>\y</code> is used to mark the word boundaries. I needed the contents of the bracketed group, i.e. the part between the <code>\y</code> markers. The <code>match()</code> function returns the groups as an array, passed in the last argument. i.e. it returns the username as <code>array[1]</code>.</p>
<p>Putting it all together we get:</p>
<div class="fragment"><div class="line">&quot;lost connection&quot; {</div>
<div class="line">if ( index( $0, &quot;id=&lt;null&gt;&quot; ) &gt; 0 ) {</div>
<div class="line">  # This is a version 2 log entry</div>
<div class="line">  match( $4, /name=\y(.+)\y,properties/, array )</div>
<div class="line">  $4 = array[1]   # Username</div>
<div class="line">  $7 = $NF        # Status</div>
<div class="line">}</div>
<div class="line">print $1 &quot;\t&quot; $7 &quot;\t&quot; $4</div>
</div><!-- fragment --><p>Here I'm conditionally replacing the fields used by the print statement. This allows a single line to contain the output format, avoiding mistakes if a change is required.</p>
<p><a href="https://www.gnu.org/software/gawk/manual/html_node/String-Functions.html">match()</a> is very powerful, it does a lot more than I've discussed here.</p>
<p>The above is an expanded explanation of the disconnect message handling outlined in <a href="https://stackoverflow.com/questions/63201356/how-do-i-filter-out-certain-text-with-awk-but-also-print-the-text/63205214#63205214">my answer</a> to a Stack Overflow question.</p>
<p><a href="https://ko-fi.com/W7W71ZMVG"><img src="https://www.ko-fi.com/img/githubbutton_sm.svg" alt="ko-fi" style="pointer-events: none;" class="inline"/></a></p>
<p> 
<a class='btn' href='wip20200720.html'>20-JUL-2020 ðŸ‘ˆ</a>
<a class='btn' href='#h20200802'>Top of page</a>
<!-- <a class='btn' href='wip20200803.html'>ðŸ‘‰ 03-AUG-2020</a> -->
<!-- <a class='btn' href='index.html'>ðŸ‘‰ 03-AUG-2020</a> -->
</p>
<p><span class="copyright">&copy; 2020 <a href="AboutMe.html" title="Terry Ebdon">Terry Ebdon.</a></span><br  />
<p>Find me coding on <a title="terry_ebdon on GitHub"
href="https://github.com/TerryEbdon">GitHub,</a> networking on <a
title="Terry Ebdon on LinkedIn"
href="https://www.linkedin.com/in/talent/">LinkedIn</a>, answering questions on
<a title="terry-ebdon on StackExchange"
href="https://stackexchange.com/users/9183134/terry-ebdon?tab=accounts">
Stack Exchange</a> and hanging out on
<a title="@terry_ebdon" href="https://twitter.com/@terry_ebdon">twitter.</a>
</p>
 </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Aug 2 2020 16:17:28 for Developer&#39;s Diary by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
