<!-- HTML header for doxygen 1.8.18-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-174219699-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-174219699-1');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Developer&#39;s Diary: 10-Jul-2020 Gradle fixed</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="myStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="terry_avi.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Developer&#39;s Diary
   </div>
   <div id="projectbrief">Software development, with Terry Ebdon</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('wip20200710.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">10-Jul-2020 Gradle fixed </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#h20200710">Clean Gradle</a></li>
<li class="level1"><a href="#autotoc_md290">Up-to-date</a><ul><li class="level2"><a href="#autotoc_md291">Missing classes</a></li>
<li class="level2"><a href="#autotoc_md292">Failing configuration</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md293">Problem solved</a><ul><li class="level2"><a href="#autotoc_md294">Working configuration</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="h20200710"></a>
Clean Gradle</h1>
<p>Yesterday's Gradle behaviour was confusing. Today I started from scratch. I created an empty folder and created a Groovy app using <code>gradle init</code>. I then ran it with <code>gradle run</code>. The code compiled and I got the expected "Hello world." message. I then tried <code>gradle test</code>. This failed with a compilation error.</p>
<div class="fragment"><div class="line">C:\z&gt;gradle test</div>
<div class="line"> </div>
<div class="line">&gt; Task :compileTestGroovy</div>
<div class="line">startup failed:</div>
<div class="line">C:z\src\test\groovy\z\AppTest.groovy: 11: unable to resolve class App</div>
<div class="line"> @ line 11, column 19.</div>
<div class="line">          def app = new App()</div>
<div class="line">                     ^</div>
<div class="line">1 error</div>
<div class="line"> </div>
<div class="line">&gt; Task :compileTestGroovy FAILED</div>
<div class="line"> </div>
<div class="line">FAILURE: Build failed with an exception.</div>
</div><!-- fragment --><p>Gradle compiled and ran the template app but will not run the template Spock test. Now it's refusing to re-run the app. It's as if running the test breaks Gradle.</p>
<div class="fragment"><div class="line">C:\z&gt;gradle run</div>
<div class="line"> </div>
<div class="line">&gt; Task :run FAILED</div>
<div class="line">Error: Could not find or load main class z.App</div>
<div class="line">Caused by: java.lang.ClassNotFoundException: z.App</div>
<div class="line"> </div>
<div class="line">FAILURE: Build failed with an exception.</div>
<div class="line"> </div>
<div class="line">* What went wrong:</div>
<div class="line">Execution failed for task &#39;:run&#39;.</div>
<div class="line">&gt; Process &#39;command &#39;java.exe&#39;&#39; finished with non-zero exit value 1</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md290"></a>
Up-to-date</h1>
<p>Running <code>gradle --console=plain clean build</code> adds some information.</p>
<div class="fragment"><div class="line">C:\z&gt;gradle --console=plain clean build</div>
<div class="line">&gt; Task :clean UP-TO-DATE</div>
<div class="line">&gt; Task :compileJava NO-SOURCE</div>
<div class="line">&gt; Task :compileGroovy UP-TO-DATE</div>
<div class="line">&gt; Task :processResources NO-SOURCE</div>
<div class="line">&gt; Task :classes UP-TO-DATE</div>
<div class="line">&gt; Task :jar</div>
<div class="line">&gt; Task :startScripts</div>
<div class="line">&gt; Task :distTar</div>
<div class="line">&gt; Task :distZip</div>
<div class="line">&gt; Task :assemble</div>
<div class="line">&gt; Task :compileTestJava NO-SOURCE</div>
</div><!-- fragment --><p>Note that it thinks the <code>clean</code> and <code>compileGroovy</code> tasks are up-to-date. The results are cached, deleting the build folder makes no difference. I then deleted <em>everything</em> in the folder, re-ran <code>gradle init</code> and re-ran the <code>gradle --console=plain clean build</code> command. (Yes, clean is redundant.) That works.</p>
<p>I can see that the class files have all built:</p>
<div class="fragment"><div class="line">C:\z&gt;dir build\classes\*.class /s /b</div>
<div class="line">C:\z\build\classes\groovy\main\z\App.class</div>
<div class="line">C:\z\build\classes\groovy\test\z\AppTest.class</div>
<div class="line"> </div>
<div class="line">C:\z&gt;</div>
</div><!-- fragment --><p>I ran the test, it succeeded. I ran the app, with <code>gradle --console=plain run</code>. It fails:</p>
<div class="fragment"><div class="line">&gt; Task :run FAILED</div>
<div class="line">Error: Could not find or load main class z.App</div>
<div class="line">Caused by: java.lang.ClassNotFoundException: z.App</div>
<div class="line"> </div>
<div class="line">FAILURE: Build failed with an exception.</div>
</div><!-- fragment --><p>At this point the test works but the app fails, claiming the app class doesn't exist. This is contradictory. Looking for the classes shows something odd:</p>
<div class="fragment"><div class="line">C:\z&gt;dir build\classes\*.class /s /b</div>
<div class="line">The system cannot find the file specified.</div>
<div class="line"> </div>
<div class="line">C:\z&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md291"></a>
Missing classes</h2>
<p>Where are the compiled classes? I tried deleting the build folder and re-running the test, but Gradle claims the compile tasks are up-to-date. Gradle is caching the build results. If I force it to re-run the tasks then everything starts working again:</p>
<div class="fragment"><div class="line">C:\z&gt;gradle --console=plain --rerun-tasks run</div>
<div class="line">&gt; Task :compileJava NO-SOURCE</div>
<div class="line">&gt; Task :compileGroovy</div>
<div class="line">&gt; Task :processResources NO-SOURCE</div>
<div class="line">&gt; Task :classes</div>
<div class="line"> </div>
<div class="line">&gt; Task :run</div>
<div class="line">    â‹®</div>
<div class="line">Hello world.</div>
<div class="line"> </div>
<div class="line">BUILD SUCCESSFUL in 4s</div>
<div class="line">2 actionable tasks: 2 executed</div>
<div class="line">C:\z&gt;</div>
</div><!-- fragment --><p>This is weird, could it be a bug in Gradle 6.5? I'll experiment with a different version.</p>
<h2><a class="anchor" id="autotoc_md292"></a>
Failing configuration</h2>
<div class="fragment"><div class="line">C:\z&gt;gradle --version</div>
<div class="line"> </div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Gradle 6.5</div>
<div class="line">------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line">Build time:   2020-06-02 20:46:21 UTC</div>
<div class="line">Revision:     a27f41e4ae5e8a41ab9b19f8dd6d86d7b384dad4</div>
<div class="line"> </div>
<div class="line">Kotlin:       1.3.72</div>
<div class="line">Groovy:       2.5.11</div>
<div class="line">Ant:          Apache Ant(TM) version 1.10.7 compiled on September 1 2019</div>
<div class="line">JVM:          11.0.2 (Oracle Corporation 11.0.2+9)</div>
<div class="line">OS:           Windows 10 10.0 amd64</div>
<div class="line"> </div>
<div class="line">C:\z&gt;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>I'm deliberately using an older JVM, this is a work-around for a previous Grails failure.</dd></dl>
<h1><a class="anchor" id="autotoc_md293"></a>
Problem solved</h1>
<p>A new Gradle version was released 10 days ago, on June 30th. This does <em>not</em> fix the issue. Versions 6.5 and 6.5.1 both exhibit the flawed behaviour. Rolling back to Gradle version 5.2.1 fixes it. I'm now wondering if my previous Grails build issues had the same cause. V5.2.1 dates from February 2019. Gradle is a very active product, this roll-back puts me nearly two dozen versions behind. It was picked purely as I've previously used it, and had it unzipped and ready to go. When I get a chance I'll try rolling it forward until it stops working, then check the change logs and bug list.</p>
<h2><a class="anchor" id="autotoc_md294"></a>
Working configuration</h2>
<div class="fragment"><div class="line">C:\z2&gt;gradle --version</div>
<div class="line"> </div>
<div class="line">------------------------------------------------------------</div>
<div class="line">Gradle 5.2.1</div>
<div class="line">------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line">Build time:   2019-02-08 19:00:10 UTC</div>
<div class="line">Revision:     f02764e074c32ee8851a4e1877dd1fea8ffb7183</div>
<div class="line"> </div>
<div class="line">Kotlin DSL:   1.1.3</div>
<div class="line">Kotlin:       1.3.20</div>
<div class="line">Groovy:       2.5.4</div>
<div class="line">Ant:          Apache Ant(TM) version 1.9.13 compiled on July 10 2018</div>
<div class="line">JVM:          11.0.2 (Oracle Corporation 11.0.2+9)</div>
<div class="line">OS:           Windows 10 10.0 amd64</div>
<div class="line"> </div>
<div class="line">C:\z2&gt;</div>
</div><!-- fragment --><p> 
<a class='btn' href='wip20200709.html'>09-JUL-2020 ðŸ‘ˆ</a>
<a class='btn' href='#h20200710'>Top of page</a>
<a class='btn' href='wip20200711.html'>ðŸ‘‰ 11-JUL-2020</a>
</p>
<p><span class="copyright">&copy; 2020 <a href="AboutMe.html" title="Terry Ebdon">Terry Ebdon.</a></span><br  />
<p>Find me coding on <a title="terry_ebdon on GitHub"
href="https://github.com/TerryEbdon">GitHub,</a> networking on <a
title="Terry Ebdon on LinkedIn"
href="https://www.linkedin.com/in/talent/">LinkedIn</a>, answering questions on
<a title="terry-ebdon on StackExchange"
href="https://stackexchange.com/users/9183134/terry-ebdon?tab=accounts">
Stack Exchange</a> and hanging out on
<a title="@terry_ebdon" href="https://twitter.com/@terry_ebdon">twitter.</a>
</p>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Aug 8 2020 16:37:48 for Developer&#39;s Diary by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
